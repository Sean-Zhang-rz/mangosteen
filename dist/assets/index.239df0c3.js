import{d as y,r,e,U as A,P as D,o as I,u as x,f,S as M,Y as S,z as U,ad as F}from"./index.1c216f5b.js";import{M as L}from"./index.f81e649c.js";import{T as $,a as C}from"./index.ba9a3160.js";import{D as E}from"./index.ff0fad93.js";import{I as P}from"./index.16a27d37.js";import{g as B}from"./tags.4059593a.js";import{B as N}from"./index.b0bad270.js";const O="_number_keyboard_9gb93_1",V="_number_keyboard__header_9gb93_4",Y="_date_9gb93_13",q="_icon_9gb93_20",z="_amount_9gb93_26",R="_number_keyboard__body_keys_9gb93_30",X="_disabled_9gb93_55",l={number_keyboard:O,number_keyboard__header:V,date:Y,icon:q,amount:z,number_keyboard__body_keys:R,disabled:X},j=y({props:{happenAt:String,amount:Number,disabled:{type:Boolean,default:!1},onSubmit:{type:Function}},setup:(s,u)=>{const t=r(s.amount?`${s.amount}`:""),i=r(!1),d=r(!1),a=c=>{const h=c.toString(),m=t.value,g=m.indexOf(".");m.length>=13||g>=0&&m.length-g>2||h==="0"&&g===-1&&m==="0"||h==="."&&g!==-1||(m==="0"&&h!=="."&&(t.value=""),t.value+=`${c}`)},_=c=>{u.emit("update:happenAt",c.toISOString()),p()},v=()=>{i.value=!0},p=()=>{i.value=!1},k=[{text:"1",onClick:()=>{a("1")}},{text:"2",onClick:()=>{a("2")}},{text:"3",onClick:()=>{a("3")}},{text:"4",onClick:()=>{a("4")}},{text:"5",onClick:()=>{a("5")}},{text:"6",onClick:()=>{a("6")}},{text:"7",onClick:()=>{a("7")}},{text:"8",onClick:()=>{a("8")}},{text:"9",onClick:()=>{a("9")}},{text:".",onClick:()=>{a(".")}},{text:"0",onClick:()=>{a("0")}},{text:"\u6E05\u7A7A",onClick:()=>{t.value="0"}},{text:"\u63D0\u4EA4",onClick:()=>{var c;u.emit("update:amount",+t.value),(c=s.onSubmit)==null||c.call(s)}}];return()=>e("div",{class:l.number_keyboard},[e("div",{class:l.number_keyboard__header},[e("span",{class:l.date},[e(P,{name:"date",class:l.icon,onClick:v},null),e("span",null,[e("span",{onClick:v},[new A(s.happenAt).format()]),e(D,{position:"bottom",show:i.value,"onUpdate:show":c=>i.value=c},{default:()=>[e(E,{modelValue:s.happenAt?new Date(s.happenAt):new Date,type:"date",title:"\u9009\u62E9\u5E74\u6708\u65E5",onConfirm:_,onCancel:p},null)]})])]),e("span",{class:l.amount},[t.value])]),e("div",{class:l.number_keyboard__body},[e("div",{class:l.number_keyboard__body_keys},[k.map(c=>e("button",{onClick:c.onClick,class:d.value?l.disabled:""},[c.text]))])])])}}),G=s=>{const u=r(0),t=r(!1),i=r([]),d=async()=>{const{data:{tagList:a,pager:_}}=await s(u.value);i.value.push(...a),t.value=(_.page-1)*_.per_page+a.length<_.count,u.value+=1};return I(d),{page:u,hasMore:t,tags:i,getTagList:d}},H="_wrapper_14htt_1",J="_tabs_14htt_6",K="_tags_wrapper_14htt_10",Q="_main_14htt_17",W="_createTag_14htt_21",Z="_tag_14htt_10",ee="_sign_14htt_34",te="_name_14htt_44",ae="_selected_14htt_48",ne="_inputPad_wrapper_14htt_51",o={wrapper:H,tabs:J,tags_wrapper:K,main:Q,createTag:W,tag:Z,sign:ee,name:te,selected:ae,inputPad_wrapper:ne},w=y({props:{kind:{type:String,required:!0},selected:String},setup:(s,u)=>{const t=x(),{tags:i,hasMore:d,getTagList:a}=G(n=>B({kind:s.kind,page:n+1}).catch(S)),_=n=>{u.emit("update:selected",n.id)},v=()=>{t.push(`/tags/create?kind=${s.kind}`)},p=r(),k=r(),c=n=>{t.push(`/tags/${n}/edit?kind=${s.kind}`)},h=(n,b)=>{k.value=n.currentTarget,p.value=setTimeout(()=>{c(b.id)},1e3)},m=n=>{clearTimeout(p.value)},g=n=>{var T;const b=document.elementFromPoint(n.touches[0].clientX,n.touches[0].clientY);k.value!==b&&!((T=k.value)!=null&&T.contains(b))&&clearTimeout(p.value)};return()=>e(M,null,[e("div",{class:o.main,onTouchmove:g},[e("div",{class:o.tag,onClick:v},[e("div",{class:o.sign},[e(P,{name:"add",class:o.createTag},null)]),e("div",{class:o.name},[f("\u65B0\u589E")])]),i.value.map(n=>e("div",{class:[o.tag,s.selected===n.id?o.selected:""],onClick:()=>_(n),onTouchstart:b=>h(b,n),onTouchend:m},[e("div",{class:o.sign},[n.sign]),e("div",{class:o.name},[n.name])]))]),e("div",{class:o.loadMore},[d.value&&i.value.length?e(N,{onClick:a},{default:()=>[f("\u52A0\u8F7D\u66F4\u591A")]}):e("span",null,[f("\u6CA1\u6709\u66F4\u591A\u4E86")])])])}}),re=y({setup:(s,u)=>{const t=U({kind:"expenses",tag_id:"",amount:0,happen_at:new Date().toISOString()}),i=x(),d=async()=>{!t.tag_id||!t.amount||(await F({...t,tag_ids:[t.tag_id]}).catch(S),i.push("/items"))};return()=>e(L,{title:"\u8BB0\u4E00\u7B14"},{default:()=>[e("div",{class:o.wrapper},[e($,{selected:t.kind,"onUpdate:selected":a=>t.kind=a,class:o.tabs},{default:()=>[e(C,{id:"expenses",name:"\u652F\u51FA",class:o.tags_wrapper},{default:()=>[e(w,{selected:t.tag_id,"onUpdate:selected":a=>t.tag_id=a,kind:"expenses",key:"expenses"},null)]}),e(C,{id:"income",name:"\u6536\u5165",class:o.tags_wrapper},{default:()=>[e(w,{selected:t.tag_id,"onUpdate:selected":a=>t.tag_id=a,kind:"income",key:"income"},null)]})]}),e("div",{class:o.inputPad_wrapper},[e(j,{happenAt:t.happen_at,"onUpdate:happenAt":a=>t.happen_at=a,amount:t.amount,"onUpdate:amount":a=>t.amount=a,onSubmit:d},null)])])]})}});export{re as default};
