import{ae as f,d as y,r as c,c as F,e,Q as I,V as S,b as k,u as B,z as N,f as m,_ as h,Y as d}from"./index.1c216f5b.js";import{M as p}from"./index.f81e649c.js";import{F as q,a as u}from"./index.707fa357.js";import{I as V}from"./index.16a27d37.js";import{B as g}from"./index.b0bad270.js";import"./index.ff0fad93.js";const w=async t=>f.post("/validation_codes",t),x=async t=>f.post("/session",t),T=y({props:{countFrom:{type:Number,default:60},disabled:{type:Boolean,default:!1},onClick:{type:Function}},setup:(t,r)=>{const s=c(),a=c(t.countFrom),o=F(()=>!!s.value),l=()=>{s.value=setInterval(()=>{a.value-=1,a.value===0&&(clearInterval(s.value),s.value=void 0,a.value=t.countFrom)},1e3)};return r.expose({startCount:l}),()=>e(g,{disabled:o.value,onClick:t.onClick},{default:()=>[o.value?`${a.value}\u79D2\u540E\u91CD\u65B0\u53D1\u9001`:"\u53D1\u9001\u9A8C\u8BC1\u7801"]})}}),M="_logo_19i5a_1",D="_icon_19i5a_8",j="_appName_19i5a_12",R="_btn_19i5a_18",n={logo:M,icon:D,appName:j,btn:R},$=y({components:{MainLayout:p},setup:()=>{const t=I();S();const r=k(),s=B(),a=c(""),o=N({email:"770899447@qq.com",code:""}),l=[{key:"email",type:"required",message:"\u5FC5\u586B"},{key:"email",type:"pattern",regex:/.+@.+/,message:"\u90AE\u7BB1\u5730\u5740\u4E0D\u6B63\u786E"},{key:"code",type:"required",message:"\u5FC5\u586B"}],v=async()=>{if(!/.+@.+/.test(o.email)){h("\u90AE\u7BB1\u5730\u5740\u4E0D\u6B63\u786E");return}await w({email:o.email}).catch(d),a.value.startCount()},b=async z=>{var i;const _=await x(o).catch(d);localStorage.setItem("jwt",_.data.jwt);const C=(i=r.query.return_to)==null?void 0:i.toString();t.refreshMe(),s.replace(C||"/start")};return()=>e(p,{title:"\u767B\u5F55",icon:"none"},{default:()=>[e("div",{class:n.wrapper},[e("div",{class:n.logo},[e(V,{class:n.icon,name:"logo"},null),e("h1",{class:n.appName},[m("\u5C71\u7AF9\u8BB0\u8D26")])]),e(q,{formData:o,rules:l,onSubmit:b},{default:()=>[e(u,{label:"\u90AE\u7BB1\u5730\u5740",prop:"email",placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1\uFF0C\u7136\u540E\u70B9\u51FB\u53D1\u9001\u9A8C\u8BC1\u7801"},null),e(u,{label:"\u9A8C\u8BC1\u7801",prop:"code",placeholder:"\u8BF7\u8F93\u5165\u516D\u4F4D\u6570\u5B57"},{button:()=>e(T,{ref:a,disabled:!o.email,onClick:v},null)}),e(u,{style:{paddingTop:"96px"}},{default:()=>[e(g,{type:"submit",class:n.btn},{default:()=>[m("\u767B\u5F55")]})]})]})])]})}});export{$ as default};
